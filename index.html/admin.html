<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Content Manager | Globalcare Physio</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@500;600;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">

    <style>
        /* Admin-specific styles */
        .admin-container {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--spacing-8);
        }

        .admin-header {
            text-align: center;
            margin-bottom: var(--spacing-8);
            padding-top: calc(var(--header-height) + var(--spacing-8));
        }

        .admin-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-2);
            padding: var(--spacing-2) var(--spacing-4);
            background: var(--warning);
            color: white;
            font-size: var(--font-size-sm);
            font-weight: 600;
            border-radius: var(--radius-full);
            margin-bottom: var(--spacing-4);
        }

        .content-type-selector {
            display: flex;
            gap: var(--spacing-3);
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: var(--spacing-8);
        }

        .type-btn {
            padding: var(--spacing-4) var(--spacing-6);
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--font-size-base);
            font-weight: 500;
        }

        .type-btn:hover {
            border-color: var(--primary-300);
        }

        .type-btn.active {
            border-color: var(--primary-500);
            background: var(--primary-50);
            color: var(--primary-700);
        }

        [data-theme="dark"] .type-btn.active {
            background: rgba(0, 180, 216, 0.15);
            color: var(--primary-500);
        }

        .form-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-8);
            margin-bottom: var(--spacing-8);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-4);
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .form-actions {
            display: flex;
            gap: var(--spacing-4);
            justify-content: flex-end;
            margin-top: var(--spacing-6);
            padding-top: var(--spacing-6);
            border-top: 1px solid var(--border-color);
        }

        .preview-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-4);
            margin-top: var(--spacing-4);
        }

        .preview-section h4 {
            margin-bottom: var(--spacing-3);
            font-size: var(--font-size-sm);
            color: var(--text-tertiary);
        }

        .preview-json {
            background: var(--bg-tertiary);
            padding: var(--spacing-4);
            border-radius: var(--radius-md);
            font-family: monospace;
            font-size: var(--font-size-sm);
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 200px;
            overflow-y: auto;
        }

        .list-input {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-2);
            margin-top: var(--spacing-2);
        }

        .list-tag {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-1);
            padding: var(--spacing-1) var(--spacing-3);
            background: var(--primary-100);
            color: var(--primary-700);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
        }

        [data-theme="dark"] .list-tag {
            background: rgba(0, 180, 216, 0.2);
            color: var(--primary-400);
        }

        .list-tag button {
            background: none;
            border: none;
            cursor: pointer;
            color: inherit;
            font-size: var(--font-size-lg);
            line-height: 1;
            opacity: 0.7;
        }

        .list-tag button:hover {
            opacity: 1;
        }

        .add-item-row {
            display: flex;
            gap: var(--spacing-2);
            margin-top: var(--spacing-2);
        }

        .add-item-row input {
            flex: 1;
        }

        .success-message {
            background: var(--secondary-100);
            color: var(--secondary-700);
            padding: var(--spacing-4);
            border-radius: var(--radius-lg);
            text-align: center;
            margin-bottom: var(--spacing-4);
        }

        [data-theme="dark"] .success-message {
            background: rgba(0, 166, 118, 0.15);
            color: var(--secondary-400);
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">üè•</div>
                <span>Globalcare Physio</span>
            </a>
            <nav class="nav">
                <a href="index.html" class="nav-link">Home</a>
                <a href="articles.html" class="nav-link">Articles</a>
                <a href="conditions.html" class="nav-link">Conditions</a>
                <a href="treatments.html" class="nav-link">Treatments</a>
                <a href="terms.html" class="nav-link">Terms</a>
            </nav>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <button class="theme-toggle" aria-label="Toggle dark mode">üåô</button>
                <button class="mobile-menu-toggle" aria-label="Toggle menu">
                    <span></span><span></span><span></span>
                </button>
            </div>
        </div>
    </header>

    <div class="admin-container">
        <!-- Header -->
        <div class="admin-header">
            <div class="admin-badge">üîê Admin Only</div>
            <h1>Content Manager</h1>
            <p class="text-secondary">Create new content entries, merge with existing data, and download updated JSON
                files.</p>
        </div>

        <!-- Content Type Selector -->
        <div class="content-type-selector">
            <button class="type-btn active" data-type="article">üì∞ Article</button>
            <button class="type-btn" data-type="condition">ü©∫ Condition</button>
            <button class="type-btn" data-type="treatment">üí™ Treatment</button>
            <button class="type-btn" data-type="term">üìö Term</button>
        </div>

        <!-- Success Message (hidden by default) -->
        <div id="success-message" class="success-message hidden">
            ‚úÖ Content created successfully! Download button is ready.
        </div>

        <!-- Article Form -->
        <div id="form-article" class="form-card">
            <h2 style="margin-bottom: var(--spacing-6);">New Article</h2>

            <div class="form-group">
                <label class="form-label">Article ID (URL slug) *</label>
                <input type="text" id="article-id" class="form-input" placeholder="e.g., benefits-of-stretching"
                    required>
                <small class="form-hint">Lowercase with hyphens, no spaces</small>
            </div>

            <div class="form-group">
                <label class="form-label">Title *</label>
                <input type="text" id="article-title" class="form-input"
                    placeholder="e.g., Benefits of Daily Stretching">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Author *</label>
                    <input type="text" id="article-author" class="form-input" value="Sachintha Sathsara">
                </div>
                <div class="form-group">
                    <label class="form-label">Date *</label>
                    <input type="date" id="article-date" class="form-input">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Category *</label>
                    <select id="article-category" class="form-input">
                        <option value="Rehabilitation">Rehabilitation</option>
                        <option value="Prevention">Prevention</option>
                        <option value="Treatment">Treatment</option>
                        <option value="Pain Management">Pain Management</option>
                        <option value="Sports">Sports</option>
                        <option value="Education">Education</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Read Time *</label>
                    <input type="text" id="article-readtime" class="form-input" placeholder="e.g., 5 min">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Featured Image URL (optional)</label>
                <input type="url" id="article-image" class="form-input" placeholder="https://example.com/image.jpg">
            </div>

            <div class="form-group">
                <label class="form-label">Excerpt (short summary) *</label>
                <textarea id="article-excerpt" class="form-textarea" rows="2"
                    placeholder="A brief summary that appears on the article card..."></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Content (HTML) *</label>
                <textarea id="article-content" class="form-textarea" rows="8"
                    placeholder="<h2>Introduction</h2><p>Your content here...</p>"></textarea>
                <small class="form-hint">Use HTML tags: &lt;h2&gt;, &lt;p&gt;, &lt;ul&gt;, &lt;li&gt;, &lt;strong&gt;,
                    etc.</small>
            </div>

            <div class="preview-section">
                <h4>üìã JSON Preview</h4>
                <pre class="preview-json" id="preview-article"></pre>
            </div>

            <div class="form-actions">
                <button class="btn btn-secondary" onclick="resetForm('article')">Clear Form</button>
                <button class="btn btn-primary" onclick="generateAndDownload('article')">üì• Download Updated
                    JSON</button>
            </div>
        </div>

        <!-- Condition Form -->
        <div id="form-condition" class="form-card hidden">
            <h2 style="margin-bottom: var(--spacing-6);">New Condition</h2>

            <div class="form-group">
                <label class="form-label">Condition ID *</label>
                <input type="text" id="condition-id" class="form-input" placeholder="e.g., rotator-cuff-injury">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Title *</label>
                    <input type="text" id="condition-title" class="form-input" placeholder="e.g., Rotator Cuff Injury">
                </div>
                <div class="form-group">
                    <label class="form-label">Icon (emoji)</label>
                    <input type="text" id="condition-icon" class="form-input" placeholder="e.g., ü©∫">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Description *</label>
                <textarea id="condition-description" class="form-textarea" rows="3"
                    placeholder="A comprehensive description of the condition..."></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Symptoms</label>
                <div class="list-input" id="condition-symptoms-list"></div>
                <div class="add-item-row">
                    <input type="text" id="condition-symptom-input" class="form-input" placeholder="Add a symptom...">
                    <button class="btn btn-secondary" onclick="addListItem('condition-symptoms')">+ Add</button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Treatments</label>
                <div class="list-input" id="condition-treatments-list"></div>
                <div class="add-item-row">
                    <input type="text" id="condition-treatment-input" class="form-input"
                        placeholder="Add a treatment...">
                    <button class="btn btn-secondary" onclick="addListItem('condition-treatments')">+ Add</button>
                </div>
            </div>

            <div class="preview-section">
                <h4>üìã JSON Preview</h4>
                <pre class="preview-json" id="preview-condition"></pre>
            </div>

            <div class="form-actions">
                <button class="btn btn-secondary" onclick="resetForm('condition')">Clear Form</button>
                <button class="btn btn-primary" onclick="generateAndDownload('condition')">üì• Download Updated
                    JSON</button>
            </div>
        </div>

        <!-- Treatment Form -->
        <div id="form-treatment" class="form-card hidden">
            <h2 style="margin-bottom: var(--spacing-6);">New Treatment</h2>

            <div class="form-group">
                <label class="form-label">Treatment ID *</label>
                <input type="text" id="treatment-id" class="form-input" placeholder="e.g., dry-needling">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Title *</label>
                    <input type="text" id="treatment-title" class="form-input" placeholder="e.g., Dry Needling">
                </div>
                <div class="form-group">
                    <label class="form-label">Icon (emoji)</label>
                    <input type="text" id="treatment-icon" class="form-input" placeholder="e.g., üíâ">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Description *</label>
                <textarea id="treatment-description" class="form-textarea" rows="3"
                    placeholder="Describe the treatment method..."></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Benefits</label>
                <div class="list-input" id="treatment-benefits-list"></div>
                <div class="add-item-row">
                    <input type="text" id="treatment-benefit-input" class="form-input" placeholder="Add a benefit...">
                    <button class="btn btn-secondary" onclick="addListItem('treatment-benefits')">+ Add</button>
                </div>
            </div>

            <div class="preview-section">
                <h4>üìã JSON Preview</h4>
                <pre class="preview-json" id="preview-treatment"></pre>
            </div>

            <div class="form-actions">
                <button class="btn btn-secondary" onclick="resetForm('treatment')">Clear Form</button>
                <button class="btn btn-primary" onclick="generateAndDownload('treatment')">üì• Download Updated
                    JSON</button>
            </div>
        </div>

        <!-- Term Form -->
        <div id="form-term" class="form-card hidden">
            <h2 style="margin-bottom: var(--spacing-6);">New Medical Term</h2>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Term *</label>
                    <input type="text" id="term-word" class="form-input" placeholder="e.g., Proprioception">
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select id="term-category" class="form-input">
                        <option value="Anatomy">Anatomy</option>
                        <option value="Movement">Movement</option>
                        <option value="Condition">Condition</option>
                        <option value="Treatment">Treatment</option>
                        <option value="Assessment">Assessment</option>
                        <option value="Neurology">Neurology</option>
                        <option value="General">General</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Definition *</label>
                <textarea id="term-definition" class="form-textarea" rows="3"
                    placeholder="A clear, student-friendly definition..."></textarea>
            </div>

            <div class="preview-section">
                <h4>üìã JSON Preview</h4>
                <pre class="preview-json" id="preview-term"></pre>
            </div>

            <div class="form-actions">
                <button class="btn btn-secondary" onclick="resetForm('term')">Clear Form</button>
                <button class="btn btn-primary" onclick="generateAndDownload('term')">üì• Download Updated JSON</button>
            </div>
        </div>

    </div>

    <script src="js/content-loader.js"></script>
    <script src="js/main.js"></script>
    <script src="js/theme.js"></script>
    <script>
        // Store list items for conditions/treatments
        const listData = {
            'condition-symptoms': [],
            'condition-treatments': [],
            'treatment-benefits': []
        };

        // Set today's date as default
        document.getElementById('article-date').valueAsDate = new Date();

        // Content type selector
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelector('.type-btn.active').classList.remove('active');
                btn.classList.add('active');

                // Hide all forms, show selected
                document.querySelectorAll('.form-card').forEach(f => f.classList.add('hidden'));
                document.getElementById(`form-${btn.dataset.type}`).classList.remove('hidden');

                // Hide success message
                document.getElementById('success-message').classList.add('hidden');
            });
        });

        // Live preview updates
        function setupPreview(type, fields) {
            fields.forEach(field => {
                const el = document.getElementById(field);
                if (el) {
                    el.addEventListener('input', () => updatePreview(type));
                }
            });
        }

        setupPreview('article', ['article-id', 'article-title', 'article-author', 'article-date', 'article-category', 'article-readtime', 'article-image', 'article-excerpt', 'article-content']);
        setupPreview('condition', ['condition-id', 'condition-title', 'condition-icon', 'condition-description']);
        setupPreview('treatment', ['treatment-id', 'treatment-title', 'treatment-icon', 'treatment-description']);
        setupPreview('term', ['term-word', 'term-category', 'term-definition']);

        function updatePreview(type) {
            const obj = buildObject(type);
            document.getElementById(`preview-${type}`).textContent = JSON.stringify(obj, null, 2);
        }

        function buildObject(type) {
            if (type === 'article') {
                const obj = {
                    id: document.getElementById('article-id').value || '',
                    title: document.getElementById('article-title').value || '',
                    author: document.getElementById('article-author').value || '',
                    date: document.getElementById('article-date').value || '',
                    readTime: document.getElementById('article-readtime').value || '',
                    category: document.getElementById('article-category').value || '',
                    excerpt: document.getElementById('article-excerpt').value || '',
                    content: document.getElementById('article-content').value || ''
                };
                const image = document.getElementById('article-image').value;
                if (image) obj.image = image;
                return obj;
            }

            if (type === 'condition') {
                return {
                    id: document.getElementById('condition-id').value || '',
                    title: document.getElementById('condition-title').value || '',
                    description: document.getElementById('condition-description').value || '',
                    symptoms: [...listData['condition-symptoms']],
                    treatments: [...listData['condition-treatments']],
                    icon: document.getElementById('condition-icon').value || 'ü©∫'
                };
            }

            if (type === 'treatment') {
                return {
                    id: document.getElementById('treatment-id').value || '',
                    title: document.getElementById('treatment-title').value || '',
                    description: document.getElementById('treatment-description').value || '',
                    icon: document.getElementById('treatment-icon').value || 'üí™',
                    benefits: [...listData['treatment-benefits']]
                };
            }

            if (type === 'term') {
                return {
                    term: document.getElementById('term-word').value || '',
                    definition: document.getElementById('term-definition').value || '',
                    category: document.getElementById('term-category').value || ''
                };
            }
        }

        function addListItem(listId) {
            const inputId = listId.replace('-symptoms', '-symptom-input')
                .replace('-treatments', '-treatment-input')
                .replace('-benefits', '-benefit-input');
            const input = document.getElementById(inputId);
            const value = input.value.trim();

            if (value) {
                listData[listId].push(value);
                input.value = '';
                renderList(listId);
                updatePreview(listId.split('-')[0]);
            }
        }

        function removeListItem(listId, index) {
            listData[listId].splice(index, 1);
            renderList(listId);
            updatePreview(listId.split('-')[0]);
        }

        function renderList(listId) {
            const container = document.getElementById(`${listId}-list`);
            container.innerHTML = listData[listId].map((item, idx) => `
        <span class="list-tag">
          ${item}
          <button onclick="removeListItem('${listId}', ${idx})">&times;</button>
        </span>
      `).join('');
        }

        // Allow Enter key to add items
        ['condition-symptom-input', 'condition-treatment-input', 'treatment-benefit-input'].forEach(id => {
            document.getElementById(id).addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const listId = id.replace('-symptom-input', '-symptoms')
                        .replace('-treatment-input', '-treatments')
                        .replace('-benefit-input', '-benefits');
                    addListItem(listId);
                }
            });
        });

        async function generateAndDownload(type) {
            const newObj = buildObject(type);

            // Map type to file and array key
            const config = {
                article: { file: 'articles', key: 'articles' },
                condition: { file: 'conditions', key: 'conditions' },
                treatment: { file: 'treatments', key: 'treatments' },
                term: { file: 'terms', key: 'terms' }
            };

            const { file, key } = config[type];

            // Load existing data
            const existingData = await contentLoader.load(file, true);
            const existingArray = existingData?.[key] || [];

            // Add new object at the beginning
            const updatedArray = [newObj, ...existingArray];
            const updatedData = { [key]: updatedArray };

            // Create and download JSON file
            const jsonString = JSON.stringify(updatedData, null, 4);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `${file}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Show success message
            document.getElementById('success-message').classList.remove('hidden');
        }

        function resetForm(type) {
            if (type === 'article') {
                ['article-id', 'article-title', 'article-image', 'article-excerpt', 'article-content', 'article-readtime'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                document.getElementById('article-author').value = 'Sachintha Sathsara';
                document.getElementById('article-date').valueAsDate = new Date();
            }

            if (type === 'condition') {
                ['condition-id', 'condition-title', 'condition-icon', 'condition-description'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                listData['condition-symptoms'] = [];
                listData['condition-treatments'] = [];
                renderList('condition-symptoms');
                renderList('condition-treatments');
            }

            if (type === 'treatment') {
                ['treatment-id', 'treatment-title', 'treatment-icon', 'treatment-description'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                listData['treatment-benefits'] = [];
                renderList('treatment-benefits');
            }

            if (type === 'term') {
                ['term-word', 'term-definition'].forEach(id => {
                    document.getElementById(id).value = '';
                });
            }

            updatePreview(type);
            document.getElementById('success-message').classList.add('hidden');
        }

        // Initial preview update
        ['article', 'condition', 'treatment', 'term'].forEach(type => updatePreview(type));
    </script>
</body>

</html>